<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive Défaillances d'Entreprises</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        .info {
            padding: 6px 8px;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .legend {
            line-height: 18px;
            color: #555;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialiser la carte
        var map = L.map('map').setView([46.5, 2.0], 6);

        // Ajouter fond de carte
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Données des défaillances d'entreprises
        var entreprises = [
            {
                nom: "STMicroelectronics",
                coords: [45.75, 4.85],
                impact: "2000-3000 postes",
                secteur: "Électronique",
                status: "Défaillance"
            },
            {
                nom: "Airbus Group",
                coords: [43.6, 1.44],
                impact: "500 postes",
                secteur: "Aéronautique",
                status: "Risque"
            },
            {
                nom: "Carrefour",
                coords: [48.85, 2.35],
                impact: "1000 postes",
                secteur: "Distribution",
                status: "Surveillance"
            }
        ];

        // Créer des icônes colorées
        var iconDefaillance = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        var iconRisque = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Ajouter les marqueurs
        entreprises.forEach(function(entreprise) {
            var icon = entreprise.status === "Défaillance" ? iconDefaillance : iconRisque;
            
            L.marker(entreprise.coords, {icon: icon})
                .addTo(map)
                .bindPopup(`
                    <h3>${entreprise.nom}</h3>
                    <p><strong>Secteur:</strong> ${entreprise.secteur}</p>
                    <p><strong>Impact:</strong> ${entreprise.impact}</p>
                    <p><strong>Status:</strong> ${entreprise.status}</p>
                `);
        });

        // Ajouter une légende
        var legend = L.control({position: 'bottomright'});
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.innerHTML = `
                <h4>Légende</h4>
                <div><i style="background: red"></i> Défaillance</div>
                <div><i style="background: orange"></i> Risque</div>
                <div><i style="background: yellow"></i> Surveillance</div>
            `;
            return div;
        };
        legend.addTo(map);

        // Ajouter le contrôle de recherche
        L.control.scale().addTo(map);
    </script>
</body>
</html>
